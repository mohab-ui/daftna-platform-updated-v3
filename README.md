# دفعتنا (Batch Hub)

مكتبة رقمية منظمة للدفعة — مبنية على Next.js + Supabase — فيها:
- مواد (Courses)
- **تقسيم داخلي لكل مادة: محاضرات (Lectures)** ✅
- داخل كل محاضرة: ملفات / ريكوردات / لينكات / أسئلة
- بحث + فلترة
- **صفحات Admin من داخل الموقع** لإدارة المواد والمحاضرات + رفع المحتوى

---

## ✅ قبل ما تبدأ
هتحتاج:
1) **Node.js** (يفضل 20 LTS أو 22 LTS)  
2) **VS Code** (اختياري بس بيسهّل)  
3) حساب على **Supabase** (Database + Auth + Storage)

> لو أنت على Windows: بعد ما تثبت Node.js افتح VS Code → افتح فولدر المشروع → Terminal.

---

## 1) إنشاء Supabase Project (مرة واحدة)
1) افتح Supabase واعمل **New project**
2) من الشريط: **SQL Editor**
3) افتح ملف `supabase/schema.sql` (جواه سكربت جاهز) واعمله **Run**
4) من الشريط: **Storage**
   - اعمل **New bucket**
   - الاسم: `resources`
   - خليه **Private**
5) ارجع لـ **SQL Editor**
   - افتح `supabase/storage_policies.sql` واعمله **Run**

✅ كده قاعدة البيانات + الصلاحيات جاهزين.

---

## 1.1) لو عندك مشروع قديم قبل نظام "المحاضرات"
لو أنت شغّال بالفعل ورفعت ملفات قبل كده، نفّذ Migration واحدة بس:

- Supabase → SQL Editor → New Query  
- افتح الملف: `supabase/migrate_add_lectures.sql`  
- اعمل **Run**

> المايجريشن دي هتنقل أي محتوى قديم تلقائيًا لمحاضرة اسمها: **"عام (قبل التقسيم)"** داخل كل مادة.

---

## 2) إعداد Auth (تسجيل الدخول)
- من Supabase: Auth → Providers
  - خلي Email provider شغال
- لو عايز تمنع أي حد من بره الدفعة:
  - Auth → Settings → **Domain allowlist** (مثلاً إيميل الجامعة)
  - أو اقفل Signup بعد ما تعمل حسابك الأول

> **مهم:** السكربت معمول بحيث **أول حساب يعمل Signup في المشروع يبقى Admin تلقائيًا** (Bootstrap).  
> لو كنت عامل حسابات قبل كده، ممكن تغيّر دورك يدويًا من جدول `profiles`.

---

## 3) تشغيل المشروع محليًا
### أ) فك الضغط وافتح المشروع
- فك الضغط عن المشروع
- افتح فولدر `batch-hub` في VS Code

### ب) حط مفاتيح Supabase
1) جوه المشروع هتلاقي ملف: `.env.local.example`  
2) اعمل نسخة منه باسم: `.env.local`
3) هات القيم من:
   - Supabase → Project Settings → API
4) املأ:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### ج) شغّل الموقع
افتح Terminal جوه VS Code واكتب (بالترتيب):
```bash
npm install
npm run dev
```

وبعدين افتح:
http://localhost:3000

---

## 4) أول مرة: إضافة موادك (Admin)
1) اعمل **Signup** بحسابك (ده هيبقى Admin لو أول حساب)
2) بعد الـ Signup هتترجّع لصفحة **Login** — سجل دخول بنفس الحساب
3) بعد الدخول هتلاقي في الشريط الجانبي (Sidebar) قسم **الإدارة**:
- **إدارة المواد**
3) افتح: `/admin/courses`
4) اضغط زر:
**إضافة مواد الترم التاني (PHARMA, PARA, MICRO, PATHO, ECE1)**

---

## 5) إنشاء محاضرات داخل كل مادة
1) افتح: `/admin/courses`
2) جنب كل مادة اضغط **محاضرات**
3) هتفتح: `/admin/courses/{courseId}/lectures`

هتقدر:
- تضيف محاضرة رقم 1 + (اختياري) اسمها بين قوسين
- تعمل إنشاء تلقائي لمحاضرات 1..N
- ترتّب المحاضرات (▲▼)
- تعديل / حذف

> نصيحة: اعمل **محاضرة 0 بعنوان "عام"** للملفات العامة.

---

## 6) رفع المحتوى (ملفات/لينكات) داخل محاضرة
- للمشرفين فقط:
  - افتح `/upload` (من Sidebar → الإدارة → رفع محتوى)
  - اختار المادة → المحاضرة → النوع → ارفع ملف أو حط لينك

---

## لو احتجت تغيّر Role يدويًا (اختياري)
لو حسابك مش admin/moderator:
- Supabase → Table Editor → `profiles`
- افتح صف حسابك وخلي `role` = `admin` أو `moderator`

> ملاحظة أمان: المستخدم العادي **مينفعش يغيّر role لنفسه** (مقفول في السكربت).

---

## ملاحظات قانونية + جودة
- متشاركوش كتب محمية بحقوق نشر بدون إذن.
- الأفضل: OER / Open Access / ملفات مسموح توزيعها / مذكراتكم الشخصية.
- للكتب الكبيرة: الأحسن **Drive Link** بدل Upload مباشر (أسرع وأريح).



---

## 1.2) تفعيل نظام MCQ (أسئلة + اختبارات + نتائج)
لو أنت شغّال على المشروع ده وعايز تضيف جزء الـ MCQ:

1) Supabase → SQL Editor → New Query
2) افتح الملف: `supabase/migrate_add_mcq.sql`
3) اعمل **Run**

بعد كده هتلاقي:
- صفحة الطالب: `/mcq` (اختبار جديد)
- صفحة المحاولات: `/mcq/history`
- صفحة المشرف: `/admin/mcq` (استيراد/مراجعة بنك الأسئلة)

> **مهم:** لو شغّلت `schema.sql` من الأول في مشروع جديد، مش هتحتاج تشغل المايجريشن.
